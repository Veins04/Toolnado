<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Palette Generator Tool</title>
  <style>
    :root{
      --sky: #57b8f0;
      --sky-700: #1e90d8;
      --bg: #ffffff;
      --muted: #6b7280;
      --card-shadow: 0 6px 18px rgba(9,30,66,0.07);
      --glass: rgba(255,255,255,0.7);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#f6fbff);color:#0b1430;min-height:100vh}

    /* layout */
    .app{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center;margin-bottom:18px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--sky),var(--sky-700));display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:18px;box-shadow:var(--card-shadow)}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .panel{display:grid;grid-template-columns:1fr 340px;gap:18px}

    /* main card */
    .card{background:var(--bg);border-radius:12px;padding:16px;box-shadow:var(--card-shadow)}
    .controls{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
    label{font-size:12px;color:var(--muted)}
    .input-row{display:flex;gap:10px;align-items:center}
    input[type=text]{padding:10px 12px;border-radius:8px;border:1px solid #e6eef9;min-width:0}
    select, button{padding:9px 12px;border-radius:8px;border:1px solid #e6eef9;background:white}
    .primary{background:var(--sky);color:white;border:none}
    .secondary{background:transparent}

    .swatches{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
    .swatch{flex:1 1 120px;border-radius:10px;overflow:hidden;min-width:90px;box-shadow:0 6px 14px rgba(14,45,73,0.06);display:flex;flex-direction:column}
    .swatch .color{height:110px}
    .swatch .meta{padding:8px;background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.98));display:flex;justify-content:space-between;align-items:center;font-size:12px}
    .meta .codes{display:flex;flex-direction:column;gap:4px}
    .meta button{padding:6px;border-radius:6px;border:1px solid #e9f5ff;background:transparent;font-size:12px}

    /* right column */
    .sidebar{display:flex;flex-direction:column;gap:12px}
    .saved-list{max-height:420px;overflow:auto;padding:8px;display:flex;flex-direction:column;gap:8px}
    .saved-item{display:flex;align-items:center;gap:8px;padding:8px;border-radius:8px;border:1px solid #eef6ff;background:linear-gradient(180deg,#fff,#fbfeff)}
    .saved-item .mini{width:36px;height:36px;border-radius:6px;flex-shrink:0}
    .small{font-size:13px;color:#02283a}

    /* footer controls */
    .row{display:flex;gap:10px;align-items:center}

    /* responsiveness */
    @media (max-width:880px){
      .panel{grid-template-columns:1fr;}
      .sidebar{order:2}
    }
    @media (max-width:480px){
      .swatch .color{height:90px}
      .swatch{flex:1 1 45%}
      .logo{width:40px;height:40px}
      h1{font-size:16px}
    }

    /* tiny helpers */
    .muted{color:var(--muted);font-size:12px}
    .flex{display:flex;gap:8px;align-items:center}
    .grow{flex:1}
    .tiny{font-size:11px}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <div class="logo">SB</div>
        <div>
          <h1>Palette Generator</h1>
          <p class="lead">Create complementary palettes (analogous, triadic, monochromatic) — skyblue themed UI</p>
        </div>
      </div>
    </header>

    <div class="panel">
      <main>
        <section class="card">
          <div class="controls" style="margin-bottom:10px">
            <div style="min-width:220px">
              <label for="baseInput">Base color (HEX / RGB / HSL)</label>
              <div class="input-row">
                <input id="baseInput" type="text" placeholder="#57b8f0 or rgb(87,184,240) or hsl(198 90% 64%)">
                <button id="parseBtn" class="primary">Use</button>
              </div>
            </div>

            <div>
              <label for="styleSelect">Palette type</label>
              <select id="styleSelect">
                <option value="analogous">Analogous</option>
                <option value="triadic">Triadic</option>
                <option value="monochrome">Monochromatic</option>
              </select>
            </div>

            <div>
              <label for="sizeRange">Palette size</label>
              <div class="input-row">
                <input id="sizeRange" type="range" min="2" max="8" value="5">
                <div class="tiny muted" id="sizeLabel">5</div>
              </div>
            </div>

            <div>
              <label>&nbsp;</label>
              <div class="row">
                <button id="generateBtn" class="primary">Generate</button>
                <button id="clearBtn" class="secondary">Clear</button>
              </div>
            </div>
          </div>

          <div class="muted tiny">Click a color code to copy. Use Save to keep palettes in your browser or export as JSON.</div>

          <div id="swatchContainer" class="swatches" aria-live="polite" style="margin-top:14px">
            <!-- generated swatches appear here -->
          </div>

          <div style="margin-top:14px;display:flex;gap:8px;flex-wrap:wrap;align-items:center">
            <button id="saveBtn" class="primary">Save palette</button>
            <button id="exportBtn">Export JSON</button>
            <button id="downloadPngBtn">Export PNG</button>
            <div class="muted tiny">Saved in-browser palettes appear at right.</div>
          </div>
        </section>
      </main>

      <aside class="sidebar">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="small">Saved palettes</div>
              <div class="muted tiny">Local storage — only on this device</div>
            </div>
            <button id="clearSaved" class="secondary tiny">Clear all</button>
          </div>

          <div id="savedList" class="saved-list" style="margin-top:12px"></div>
        </div>

        <div class="card">
          <div class="small">Quick actions</div>
          <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
            <button id="useSky" class="primary">Use default skybase</button>
            <button id="contrastInfo">Contrast check</button>
          </div>
          <div id="contrastBlock" style="margin-top:10px;display:none" class="muted tiny"></div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    /* Utility: parse color strings to H,S,L and back. Handles hex, rgb(), rgba(), hsl().
       The approach: normalize to an rgb object then convert to hsl. */
    function clamp(v,a,b){return Math.max(a,Math.min(b,v))}

    function hexToRgb(hex){
      hex = hex.replace('#','').trim();
      if(hex.length === 3) hex = hex.split('').map(c=>c+c).join('');
      if(!/^[0-9a-fA-F]{6}$/.test(hex)) return null;
      return {r:parseInt(hex.slice(0,2),16), g:parseInt(hex.slice(2,4),16), b:parseInt(hex.slice(4,6),16)};
    }
    function rgbStringToRgb(str){
      const m = str.match(/rgba?\(([^)]+)\)/i);
      if(!m) return null;
      const parts = m[1].split(',').map(s=>s.trim());
      return {r:parseFloat(parts[0]), g:parseFloat(parts[1]), b:parseFloat(parts[2])};
    }
    function hslStringToHsl(str){
      const m = str.match(/hsla?\(([^)]+)\)/i);
      if(!m) return null;
      let parts = m[1].split(/,|\s/).filter(Boolean);
      // allow both h s% l% and h s% l% with commas
      const h = parseFloat(parts[0]);
      const s = parseFloat((parts[1]||'0').toString().replace('%',''));
      const l = parseFloat((parts[2]||'0').toString().replace('%',''));
      return {h:((h%360)+360)%360, s:clamp(s,0,100), l:clamp(l,0,100)};
    }

    function rgbToHsl(r,g,b){
      r/=255;g/=255;b/=255;
      const max = Math.max(r,g,b), min = Math.min(r,g,b);
      let h=0,s=0,l=(max+min)/2;
      if(max!==min){
        const d = max-min;
        s = l>0.5?d/(2-max-min):d/(max+min);
        switch(max){
          case r: h = (g-b)/d + (g<b?6:0); break;
          case g: h = (b-r)/d + 2; break;
          case b: h = (r-g)/d + 4; break;
        }
        h *= 60;
      }
      return {h:Math.round(h), s:Math.round(s*100), l:Math.round(l*100)};
    }
    function hslToRgb(h,s,l){
      s/=100; l/=100; h/=360;
      if(s===0){const v=Math.round(l*255);return {r:v,g:v,b:v};}
      function hue2rgb(p,q,t){
        if(t<0) t+=1; if(t>1) t-=1;
        if(t<1/6) return p+(q-p)*6*t;
        if(t<1/2) return q;
        if(t<2/3) return p+(q-p)*(2/3 - t)*6;
        return p;
      }
      const q = l<0.5 ? l*(1+s) : l+s - l*s;
      const p = 2*l - q;
      const r = Math.round(hue2rgb(p,q,h+1/3)*255);
      const g = Math.round(hue2rgb(p,q,h)*255);
      const b = Math.round(hue2rgb(p,q,h-1/3)*255);
      return {r,g,b};
    }
    function rgbToHex({r,g,b}){return '#'+[r,g,b].map(x=>x.toString(16).padStart(2,'0')).join('').toUpperCase();}
    function hslToString(hsl){return `hsl(${hsl.h} ${hsl.s}% ${hsl.l}%)`}
    function rgbToString({r,g,b}){return `rgb(${r}, ${g}, ${b})`}

    function parseColor(input){
      if(!input) return null;
      input = input.trim();
      // hex
      const hexMatch = input.match(/^#?[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/);
      if(hexMatch){
        const rgb = hexToRgb(input.replace('#',''));
        if(!rgb) return null;
        return rgbToHsl(rgb.r,rgb.g,rgb.b);
      }
      // rgb()
      if(/rgb\(/i.test(input)){
        const rgb = rgbStringToRgb(input);
        if(!rgb) return null;
        return rgbToHsl(rgb.r,rgb.g,rgb.b);
      }
      // hsl()
      if(/hsl\(/i.test(input)){
        const hsl = hslStringToHsl(input);
        if(!hsl) return null;
        return hsl;
      }
      return null;
    }

    /* Palette generators */
    function generateAnalogous(baseHsl, count){
      const spread = 30; // degrees spread across neighbors
      const colors = [];
      // center index
      const mid = Math.floor(count/2);
      for(let i=0;i<count;i++){
        const offset = (i-mid) * spread;
        colors.push({h:((baseHsl.h+offset)%360+360)%360, s:baseHsl.s, l:baseHsl.l});
      }
      return colors;
    }
    function generateTriadic(baseHsl, count){
      const colors = [];
      if(count===2){
        colors.push(baseHsl, {h:(baseHsl.h+180)%360, s:baseHsl.s, l:baseHsl.l});
        return colors;
      }
      // sprinkle colors between 3 anchor hues (0, +120, -120)
      const anchors = [0,120,240].map(a=> (baseHsl.h + a)%360);
      for(let i=0;i<count;i++){
        const anchor = anchors[i % anchors.length];
        // vary lightness slightly to make more distinct
        const l = clamp(baseHsl.l + Math.round(((i/ count)-0.5)*20), 8, 92);
        colors.push({h:anchor, s:baseHsl.s, l});
      }
      return colors;
    }
    function generateMonochrome(baseHsl, count){
      const colors = [];
      const step = 18; // brightness step
      const start = baseHsl.l - Math.floor(count/2)*step;
      for(let i=0;i<count;i++){
        colors.push({h: baseHsl.h, s: baseHsl.s, l: clamp(start + i*step, 5, 95)});
      }
      return colors;
    }

    /* UI wiring */
    const baseInput = document.getElementById('baseInput');
    const parseBtn = document.getElementById('parseBtn');
    const generateBtn = document.getElementById('generateBtn');
    const swatchContainer = document.getElementById('swatchContainer');
    const styleSelect = document.getElementById('styleSelect');
    const sizeRange = document.getElementById('sizeRange');
    const sizeLabel = document.getElementById('sizeLabel');
    const clearBtn = document.getElementById('clearBtn');
    const saveBtn = document.getElementById('saveBtn');

    const exportBtn = document.getElementById('exportBtn');
    const downloadPngBtn = document.getElementById('downloadPngBtn');
    const savedList = document.getElementById('savedList');
    const clearSaved = document.getElementById('clearSaved');
    const useSky = document.getElementById('useSky');
    const contrastInfo = document.getElementById('contrastInfo');
    const contrastBlock = document.getElementById('contrastBlock');

    sizeRange.addEventListener('input', ()=>{sizeLabel.textContent = sizeRange.value});

    parseBtn.addEventListener('click', ()=>{
      const parsed = parseColor(baseInput.value);
      if(!parsed){
        alert('Could not parse color. Use HEX (#RRGGBB), rgb(r,g,b) or hsl(h s% l%).');
        return;
      }
      // show a quick preview by generating now
      generateAndRender(parsed);
    });

    generateBtn.addEventListener('click', ()=>{
      const parsed = parseColor(baseInput.value);
      if(!parsed){alert('Please enter a valid base color.');return}
      generateAndRender(parsed);
    });

    clearBtn.addEventListener('click', ()=>{swatchContainer.innerHTML='';});

    useSky.addEventListener('click', ()=>{baseInput.value = '#57b8f0'; parseBtn.click();});

    contrastInfo.addEventListener('click', ()=>{
      const parsed = parseColor(baseInput.value);
      if(!parsed){contrastBlock.style.display='block'; contrastBlock.textContent = 'Enter a base color first.'; return}
      const colors = generateForUI(parsed);
      // quick contrast between first and last
      const first = colors[0]; const last = colors[colors.length-1];
      const c = contrastRatio(hslToRgb(first), hslToRgb(last));
      contrastBlock.style.display='block';
      contrastBlock.innerHTML = `Contrast ratio between first and last color: <strong>${c.toFixed(2)}:1</strong>.`;
    });

    function generateForUI(baseHsl){
      const size = parseInt(sizeRange.value,10);
      const type = styleSelect.value;
      if(type==='analogous') return generateAnalogous(baseHsl,size);
      if(type==='triadic') return generateTriadic(baseHsl,size);
      return generateMonochrome(baseHsl,size);
    }

    function generateAndRender(baseHsl){
      const colors = generateForUI(baseHsl);
      renderSwatches(colors);
    }

    function renderSwatches(hslList){
      swatchContainer.innerHTML = '';
      hslList.forEach(hsl=>{
        const rgb = hslToRgb(hsl.h,hsl.s,hsl.l);
        const hex = rgbToHex(rgb);
        const hslText = hslToString(hsl);
        const rgbText = rgbToString(rgb);
        const sw = document.createElement('div'); sw.className='swatch';
        const colorBox = document.createElement('div'); colorBox.className='color'; colorBox.style.background = hex;
        const meta = document.createElement('div'); meta.className='meta';
        const codes = document.createElement('div'); codes.className='codes';
        const hexEl = document.createElement('div'); hexEl.textContent = hex; hexEl.title='Click to copy hex'; hexEl.style.cursor='pointer';
        const rgbEl = document.createElement('div'); rgbEl.textContent = rgbText; rgbEl.title='Click to copy rgb'; rgbEl.style.cursor='pointer';
        codes.appendChild(hexEl); codes.appendChild(rgbEl);
        const actions = document.createElement('div'); actions.style.display='flex'; actions.style.flexDirection='column'; actions.style.gap='6px';
        const copyBtn = document.createElement('button'); copyBtn.textContent = 'Copy';
        copyBtn.addEventListener('click', ()=>{navigator.clipboard.writeText(hex).then(()=>copyBtn.textContent='Copied'); setTimeout(()=>copyBtn.textContent='Copy',1200)});
        const addBtn = document.createElement('button'); addBtn.textContent='Use'; addBtn.addEventListener('click', ()=>{baseInput.value = hex; });
        actions.appendChild(copyBtn); actions.appendChild(addBtn);
        meta.appendChild(codes); meta.appendChild(actions);

        // copy by clicking the code text
        [hexEl,rgbEl].forEach(el=>el.addEventListener('click', ()=>{navigator.clipboard.writeText(el.textContent); el.style.opacity=0.6; setTimeout(()=>el.style.opacity=1,500)}));

        sw.appendChild(colorBox); sw.appendChild(meta);
        swatchContainer.appendChild(sw);
      });
    }

    /* Save / load palettes (localStorage) */
    function loadSaved(){
      const raw = localStorage.getItem('sb_palettes')||'[]';
      try{return JSON.parse(raw)}catch(e){return []}
    }
    function saveSaved(list){localStorage.setItem('sb_palettes', JSON.stringify(list)); renderSaved();}
    function renderSaved(){
      const list = loadSaved(); savedList.innerHTML='';
      if(list.length===0){savedList.innerHTML='<div class="muted tiny">No saved palettes yet.</div>';return}
      list.slice().reverse().forEach((p,idx)=>{
        const item = document.createElement('div'); item.className='saved-item';
        const mini = document.createElement('div'); mini.className='mini'; mini.style.display='flex';
        // render little color chips
        mini.innerHTML = p.colors.map(c=>`<div style="width:10px;height:10px;margin-right:4px;border-radius:2px;background:${c.hex}"></div>`).join('');
        const meta = document.createElement('div'); meta.style.flex='1'; meta.innerHTML = `<div class='small'>${p.name||'Palette'}</div><div class='muted tiny'>${p.date}</div>`;
        const actions = document.createElement('div'); actions.style.display='flex'; actions.style.flexDirection='column'; actions.style.gap='6px';
        const loadBtn = document.createElement('button'); loadBtn.textContent='Load'; loadBtn.className='tiny'; loadBtn.addEventListener('click', ()=>{ baseInput.value = p.base; parseBtn.click(); });
        const dlBtn = document.createElement('button'); dlBtn.textContent='Export'; dlBtn.className='tiny'; dlBtn.addEventListener('click', ()=>{ downloadJSON(p); });
        const delBtn = document.createElement('button'); delBtn.textContent='Delete'; delBtn.className='tiny'; delBtn.addEventListener('click', ()=>{ if(confirm('Delete this saved palette?')){ const arr = loadSaved(); arr.splice(arr.length -1 -idx,1); saveSaved(arr); }});
        actions.appendChild(loadBtn); actions.appendChild(dlBtn); actions.appendChild(delBtn);
        item.appendChild(mini); item.appendChild(meta); item.appendChild(actions);
        savedList.appendChild(item);
      });
    }

    saveBtn.addEventListener('click', ()=>{
      const parsed = parseColor(baseInput.value);
      if(!parsed){alert('Enter a valid base color to save.');return}
      const colorsHsl = generateForUI(parsed);
      const colors = colorsHsl.map(h=>{const rgb=hslToRgb(h.h,h.s,h.l);return {hex:rgbToHex(rgb), rgb:rgbToString(rgb), hsl:hslToString(h)}});
      const list = loadSaved();
      const p = {name: `Palette ${new Date().toLocaleString()}`, date: new Date().toLocaleString(), base: baseInput.value, type: styleSelect.value, colors};
      list.push(p); saveSaved(list); alert('Saved palette locally.');
    });

    clearSaved.addEventListener('click', ()=>{ if(confirm('Clear all saved palettes?')){ localStorage.removeItem('sb_palettes'); renderSaved(); }});

    exportBtn.addEventListener('click', ()=>{
      // export currently visible swatches
      const blocks = Array.from(document.querySelectorAll('#swatchContainer .swatch'));
      if(blocks.length===0){alert('No palette to export.');return}
      const payload = {date:new Date().toISOString(), items: blocks.map(b=>({hex: b.querySelector('.codes div').textContent}))};
      const blob = new Blob([JSON.stringify(payload,null,2)],{type:'application/json'});
      const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'palette.json'; a.click(); URL.revokeObjectURL(url);
    });

    function downloadJSON(obj){ const blob = new Blob([JSON.stringify(obj,null,2)],{type:'application/json'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=(obj.name||'palette')+'.json'; a.click(); }

    downloadPngBtn.addEventListener('click', ()=>{
      // simple export: create a canvas, draw vertical swatches with hex labels
      const blocks = Array.from(document.querySelectorAll('#swatchContainer .swatch'));
      if(blocks.length===0){alert('No palette to export.');return}
      const width = 900; const height = 120 * blocks.length;
      const canvas = document.createElement('canvas'); canvas.width=width; canvas.height=height; const ctx=canvas.getContext('2d');
      blocks.forEach((b,i)=>{
        const hex = b.querySelector('.codes div').textContent;
        ctx.fillStyle = hex; ctx.fillRect(0,i*120,width,120);
        ctx.fillStyle = '#ffffff'; ctx.font='20px Arial'; ctx.fillText(hex,20, (i*120)+40);
      });
      canvas.toBlob(t=>{ const a=document.createElement('a'); a.href=URL.createObjectURL(t); a.download='palette.png'; a.click(); },'image/png');
    });

    function contrastRatio(rgbA, rgbB){
      const lum = c=>{c=[c.r/255,c.g/255,c.b/255].map(v=>v<=0.03928? v/12.92: Math.pow((v+0.055)/1.055,2.4)); return 0.2126*c[0]+0.7152*c[1]+0.0722*c[2]};
      const L1 = lum(rgbA); const L2 = lum(rgbB); const top = Math.max(L1,L2); const bot = Math.min(L1,L2); return (top+0.05)/(bot+0.05);
    }

    // boot
    renderSaved();
    // accessibility: allow enter key to trigger parse
    baseInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ parseBtn.click(); }});
  </script>
</body>
</html>
