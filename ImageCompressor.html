<!doctype html>
<html lang="en">
<head>
   <link rel="icon" href="newfavicon-16x16.png" type="image/x-icon">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Image Compressor</title>
  <style>
    :root{
      --sky:#87CEEB;
      --white:#ffffff;
      --muted:#6b7280;
      --glass: rgba(255,255,255,0.7);
      --card-shadow: 0 10px 30px rgba(10, 25, 47, 0.08);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{height:100%;}
    body{
      margin:0;
      background: linear-gradient(180deg,var(--sky) 0%, #e9f7ff 100%);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
      color:#0f172a;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .wrap{
      width:100%;
      max-width:960px;
    }

    header{
      display:flex;
      align-items:center;
      gap:16px;
      margin-bottom:18px;
    }
    .logo{
      width:56px;height:56px;border-radius:12px;background:var(--white);display:flex;align-items:center;justify-content:center;box-shadow:var(--card-shadow);
    }
    .logo svg{width:36px;height:36px}
    h1{font-size:18px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.95));
      border-radius:16px;
      padding:18px;
      box-shadow:var(--card-shadow);
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 380px;
      gap:18px;
    }

    @media (max-width:880px){
      .grid{grid-template-columns:1fr}
    }

    .drop-area{
      border:2px dashed rgba(15,23,42,0.08);
      border-radius:12px;padding:18px;min-height:300px;display:flex;flex-direction:column;gap:12px;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.5));
    }
    .drop-area.dragover{border-color:rgba(15,23,42,0.18);box-shadow:0 8px 30px rgba(0,0,0,0.06) inset}
    .drop-hint{color:var(--muted);text-align:center}

    .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
    .btn{background:var(--sky);color:var(--white);border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
    .btn.ghost{background:transparent;border:1px solid rgba(15,23,42,0.06);color:var(--muted);font-weight:600}
    input[type=file]{display:none}

    .preview{
      width:100%;height:100%;display:flex;flex-direction:column;gap:10px;align-items:center;justify-content:flex-start;padding:6px;box-sizing:border-box
    }
    .preview img{max-width:100%;height:auto;border-radius:10px;display:block;box-shadow:0 6px 20px rgba(2,6,23,0.06)}

    .sidebar{
      display:flex;flex-direction:column;gap:12px;padding:6px;
    }
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    .row{display:flex;gap:8px;align-items:center}
    .range{width:100%}
    .meta{font-size:13px;color:var(--muted)}

    .out-info{background:var(--glass);padding:8px;border-radius:10px}

    .footer{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:10px}

    small.note{display:block;color:var(--muted);text-align:center;margin-top:8px}

    /* small helpers */
    .muted{color:var(--muted);font-size:13px}

  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" aria-hidden>
        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="2" y="3" width="20" height="18" rx="4" fill="#87CEEB"/><path d="M7 9h10M7 13h6" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </div>
      <div>
        <h1>Image Compressor</h1>
        <p class="lead">Upload, preview and download compressed images — all in your browser. No server required.</p>
      </div>
    </header>

    <div class="card">
      <div class="grid">

        <!-- Left: Drop + Preview -->
        <section>
          <div id="drop" class="drop-area" tabindex="0" aria-label="Drop image here">
            <div class="preview" id="preview-area">
              <div style="text-align:center">
                <svg width="72" height="72" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 3v9" stroke="#0f172a" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M21 15v2a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-2" stroke="#0f172a" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/><path d="M7 10l5-5 5 5" stroke="#0f172a" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <p class="drop-hint">Drag & drop an image here, or <label for="file-input" class="btn ghost" style="display:inline-block;cursor:pointer;margin:6px 0;">Choose file</label></p>
                <input id="file-input" type="file" accept="image/*">
                <small class="muted">Supported: JPG, PNG, WEBP, GIF (animated GIFs will be flattened)</small>
              </div>

              <div id="image-preview-wrapper" style="display:none;width:100%">
                <img id="image-preview" alt="Selected image preview">
                <div class="meta" id="sizes">Original: — • Compressed: —</div>
              </div>
            </div>
          </div>

          <div class="controls" style="margin-top:12px;justify-content:center">
            <button id="compress-btn" class="btn" disabled>Compress</button>
            <a id="download-btn" class="btn ghost" style="display:none;text-decoration:none;" download>Download</a>
            <button id="reset-btn" class="btn ghost" style="display:none;">Reset</button>
          </div>

          <small class="note">Compression is done locally in your browser. Images are not uploaded to any server.</small>
        </section>

        <!-- Right: Controls -->
        <aside class="sidebar">
          <div>
            <label for="format">Format</label>
            <select id="format" aria-label="Output format" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(2,6,23,0.06);">
              <option value="image/jpeg">JPEG (good size / quality)</option>
              <option value="image/webp">WebP (smaller if supported)</option>
              <option value="image/png">PNG (lossless)</option>
            </select>
          </div>

          <div>
            <label for="quality">Quality <span id="quality-val">0.75</span></label>
            <input id="quality" class="range" type="range" min="0.1" max="1" step="0.01" value="0.75">
            <small class="muted">Lower values = smaller file, lower visual quality.</small>
          </div>

          <div>
            <label for="max-width">Max width (px, 0 = keep original)</label>
            <input id="max-width" type="number" placeholder="0" min="0" style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(2,6,23,0.06);">
            <small class="muted">Set maximum width to scale down large images (helps compression).</small>
          </div>

          <div class="out-info">
            <label>Output info</label>
            <div style="display:flex;flex-direction:column;gap:6px;margin-top:8px">
              <div class="row"><strong id="out-name">—</strong></div>
              <div class="row muted"><span id="out-size">—</span></div>
              <div class="row muted"><span id="out-dim">—</span></div>
            </div>
          </div>

          <div style="margin-top:auto">
            <label>Tips</label>
            <ul style="margin:8px 0 0 18px;color:var(--muted)">
              <li>Use WebP for best size when supported.</li>
              <li>Reduce quality or max-width for much smaller files.</li>
              <li>PNG is lossless — use only if you need transparency.</li>
            </ul>
          </div>

        </aside>

      </div>
    </div>
  </div>

  <script>
    // Elements
    const drop = document.getElementById('drop');
    const fileInput = document.getElementById('file-input');
    const previewWrapper = document.getElementById('image-preview-wrapper');
    const previewImg = document.getElementById('image-preview');
    const sizesEl = document.getElementById('sizes');
    const compressBtn = document.getElementById('compress-btn');
    const downloadBtn = document.getElementById('download-btn');
    const resetBtn = document.getElementById('reset-btn');
    const formatSel = document.getElementById('format');
    const qualityRange = document.getElementById('quality');
    const qualityVal = document.getElementById('quality-val');
    const maxWidthInput = document.getElementById('max-width');
    const outName = document.getElementById('out-name');
    const outSize = document.getElementById('out-size');
    const outDim = document.getElementById('out-dim');

    let originalFile = null;
    let compressedBlob = null;

    // Helpers
    function formatBytes(bytes){
      if (bytes === 0) return '0 B';
      const k = 1024;
      const sizes = ['B','KB','MB','GB'];
      const i = Math.floor(Math.log(bytes)/Math.log(k));
      return parseFloat((bytes / Math.pow(k,i)).toFixed(2)) + ' ' + sizes[i];
    }

    qualityRange.addEventListener('input', ()=>{
      qualityVal.textContent = qualityRange.value;
    });

    // Drag & drop
    ['dragenter','dragover'].forEach(evt=>{
      drop.addEventListener(evt, e=>{e.preventDefault();e.stopPropagation();drop.classList.add('dragover');});
    });
    ['dragleave','drop'].forEach(evt=>{
      drop.addEventListener(evt, e=>{e.preventDefault();e.stopPropagation();drop.classList.remove('dragover');});
    });

    drop.addEventListener('drop', e=>{
      const dt = e.dataTransfer;
      if (dt && dt.files && dt.files.length) handleFile(dt.files[0]);
    });

    fileInput.addEventListener('change', ()=>{
      if (fileInput.files && fileInput.files[0]) handleFile(fileInput.files[0]);
    });

    function handleFile(file){
      if (!file.type.startsWith('image/')){
        alert('Please select an image file.');
        return;
      }
      originalFile = file;
      const url = URL.createObjectURL(file);
      previewImg.src = url;
      previewImg.onload = ()=>{
        previewWrapper.style.display = 'block';
        sizesEl.textContent = `Original: ${formatBytes(file.size)} • Compressed: —`;
        compressBtn.disabled = false;
        resetBtn.style.display = 'inline-block';
        outName.textContent = file.name;
        outSize.textContent = `Original: ${formatBytes(file.size)}`;
        outDim.textContent = `${previewImg.naturalWidth} × ${previewImg.naturalHeight}`;
      };
    }

    // Compress logic
    compressBtn.addEventListener('click', async ()=>{
      if (!originalFile) return;
      compressBtn.disabled = true;
      compressBtn.textContent = 'Compressing...';

      try{
        const quality = parseFloat(qualityRange.value);
        const mime = formatSel.value;
        const maxW = parseInt(maxWidthInput.value) || 0;

        const compressed = await compressImageFile(originalFile, {quality, mime, maxWidth: maxW});
        compressedBlob = compressed.blob;

        const url = URL.createObjectURL(compressedBlob);
        downloadBtn.href = url;
        const ext = mime.split('/')[1].split(';')[0] || 'jpg';
        downloadBtn.download = (originalFile.name.replace(/\.[^.]+$/, '') || 'image') + '-compressed.' + ext;
        downloadBtn.style.display = 'inline-block';

        sizesEl.textContent = `Original: ${formatBytes(originalFile.size)} • Compressed: ${formatBytes(compressedBlob.size)}`;
        outSize.textContent = `Compressed: ${formatBytes(compressedBlob.size)}`;
        outDim.textContent = `${compressed.width} × ${compressed.height}`;

      }catch(err){
        console.error(err);
        alert('Compression failed: ' + err.message);
      }finally{
        compressBtn.disabled = false;
        compressBtn.textContent = 'Compress';
      }
    });

    resetBtn.addEventListener('click', ()=>{
      originalFile = null; compressedBlob = null;
      previewWrapper.style.display = 'none';
      previewImg.src = '';
      compressBtn.disabled = true;
      downloadBtn.style.display = 'none';
      resetBtn.style.display = 'none';
      outName.textContent = '—'; outSize.textContent='—'; outDim.textContent='—';
      sizesEl.textContent = 'Original: — • Compressed: —';
      fileInput.value = '';
    });

    // Main compression function
    function compressImageFile(file, opts = {}){
      const {quality = 0.8, mime = 'image/jpeg', maxWidth = 0} = opts;
      return new Promise((resolve, reject)=>{
        const img = new Image();
        img.onload = ()=>{
          let targetW = img.naturalWidth;
          let targetH = img.naturalHeight;

          if (maxWidth > 0 && img.naturalWidth > maxWidth){
            targetW = maxWidth;
            targetH = Math.round((img.naturalHeight / img.naturalWidth) * targetW);
          }

          const canvas = document.createElement('canvas');
          canvas.width = targetW;
          canvas.height = targetH;
          const ctx = canvas.getContext('2d');

          // For PNGs with transparency, preserve alpha
          if (mime === 'image/png'){
            ctx.clearRect(0,0,canvas.width,canvas.height);
          } else {
            // fill white background for lossy formats to avoid black background on transparent images
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0,0,canvas.width,canvas.height);
          }

          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

          // toBlob is async
          canvas.toBlob((blob)=>{
            if (!blob){
              reject(new Error('Compression produced no data'));
              return;
            }
            resolve({blob, width: canvas.width, height: canvas.height});
          }, mime, quality);
        };
        img.onerror = (e)=>reject(new Error('Unable to load the image'));

        // Read file as data URL
        const reader = new FileReader();
        reader.onload = ()=>{ img.src = reader.result; };
        reader.onerror = ()=>reject(new Error('Failed reading file'));
        reader.readAsDataURL(file);
      });
    }

    // Accessibility: keyboard file pick when drop area focused + Enter
    drop.addEventListener('keydown', (e)=>{
      if (e.key === 'Enter' || e.key === ' ') fileInput.click();
    });

    // If browser supports showSaveFilePicker? we stick with anchor download which is broadly supported

    // Clean up object URLs on unload
    window.addEventListener('unload', ()=>{
      try{ if (downloadBtn && downloadBtn.href) URL.revokeObjectURL(downloadBtn.href); }catch(e){}
    });

  </script>
</body>
</html>
